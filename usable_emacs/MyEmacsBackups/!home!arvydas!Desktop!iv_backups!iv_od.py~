from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By # deprecation warning removed
from configparser import ConfigParser
from selenium import webdriver
import time

driver = webdriver.Chrome("/home/arvydas/Desktop/chromedriver")
driver.maximize_window()

def main():
    iv_login()
    do_backup()

def read_user():
    file = '/home/arvydas/Desktop/config.ini'
    config = ConfigParser()
    config.read(file)
    return(config['obels']['user'])

def read_pass():
    file = '/home/arvydas/Desktop/config.ini'
    config = ConfigParser()
    config.read(file)
    return(config['obels']['pass'])

def read_ivlt():
    # read website url from an external config file
    file = '/home/arvydas/Desktop/config.ini'
    config = ConfigParser()
    config.read(file)
    return(config['obels']['ivlt'])

def read_backup_page():
    # read website url for a backup from an external config file
    file = '/home/arvydas/Desktop/config.ini'
    config = ConfigParser()
    config.read(file)
    return(config['obels']['backup_page'])

def iv_login():
    browser = driver.get(read_ivlt())
    driver.find_element(By.NAME, "nick").send_keys(read_user())
    driver.find_element(By.NAME, "password").send_keys(read_pass())
    time.sleep(10)
    driver.find_element_by_css_selector("input[type=\"submit\" i]").click()
    print("logged_in")
    
def do_backup():
    
    driver.find_element(By.XPATH,'/html/body/table[2]/tbody/tr/td/table/tbody/tr[5]/td/ul[1]/li[2]/a').click()
    time.sleep(1)
    driver.find_element(By.LINK_TEXT, "DirectAdmin").click()
    time.sleep(1)
    driver.get(read_backup_page())
    time.sleep(1)
    driver.find_element_by_css_selector("input[type=\"submit\" i]").click()
    print("backup OD done")

if __name__ == '__main__':
    main()
